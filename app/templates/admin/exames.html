{% extends "admin/base.html" %}

{% block title %}Gerenciar Exames - Help Alpha Admin{% endblock %}
{% block page_title %}Gerenciar Exames{% endblock %}

{% block content %}
<!-- Header Actions -->
<div class="level">
    <div class="level-left">
        <div class="level-item">
            <h3 class="title is-4">
                <span class="icon">
                    <i class="fas fa-flask"></i>
                </span>
                <span>Exames Cadastrados ({{ exames|length }})</span>
            </h3>
        </div>
    </div>
    <div class="level-right">
        <div class="level-item">
            <a href="{{ url_for('admin_add_exame') }}" class="button is-primary">
                <span class="icon">
                    <i class="fas fa-plus"></i>
                </span>
                <span>Adicionar Exame</span>
            </a>
        </div>
    </div>
</div>

{% if exames %}
    <!-- Exames Table -->
    <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable">
            <thead>
                <tr>
                    <th>Nome do Exame</th>
                    <th>Descrição</th>
                    <th>Duração</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for exame in exames %}
                <tr>
                    <td>
                        <strong>{{ exame.nome }}</strong>
                    </td>
                    <td>
                        <p class="is-size-7">{{ exame.descricao[:100] }}{% if exame.descricao|length > 100 %}...{% endif %}</p>
                    </td>
                    <td>
                        <span class="tag is-info is-light">{{ exame.tempo }}</span>
                    </td>
                    <td>
                        <div class="buttons are-small">
                            <a href="{{ url_for('exame', nome=exame.nome) }}" target="_blank" class="button is-info" title="Visualizar">
                                <span class="icon">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </a>
                            <a href="{{ url_for('admin_edit_exame', nome=exame.nome) }}" class="button is-warning" title="Editar">
                                <span class="icon">
                                    <i class="fas fa-edit"></i>
                                </span>
                            </a>
                            <button class="button is-danger" onclick="confirmDelete('{{ exame.nome }}')" title="Excluir">
                                <span class="icon">
                                    <i class="fas fa-trash"></i>
                                </span>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">
                    <span class="icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </span>
                    <span>Confirmar Exclusão</span>
                </p>
                <button class="delete" aria-label="close" onclick="closeModal()"></button>
            </header>
            <section class="modal-card-body">
                <p>Tem certeza que deseja excluir o exame <strong id="exameNome"></strong>?</p>
                <p class="has-text-danger">Esta ação não pode ser desfeita!</p>
            </section>
            <footer class="modal-card-foot">
                <form id="deleteForm" method="POST">
                    <button class="button is-danger" type="submit">
                        <span class="icon">
                            <i class="fas fa-trash"></i>
                        </span>
                        <span>Sim, Excluir</span>
                    </button>
                </form>
                <button class="button" onclick="closeModal()">Cancelar</button>
            </footer>
        </div>
    </div>

{% else %}
    <!-- Empty State -->
    <div class="notification is-light has-text-centered">
        <span class="icon is-large">
            <i class="fas fa-flask fa-3x has-text-grey-light"></i>
        </span>
        <h4 class="title is-4 has-text-grey">Nenhum exame cadastrado</h4>
        <p class="subtitle is-6 has-text-grey">Comece adicionando o primeiro exame ao sistema.</p>
        <a href="{{ url_for('admin_add_exame') }}" class="button is-primary">
            <span class="icon">
                <i class="fas fa-plus"></i>
            </span>
            <span>Adicionar Primeiro Exame</span>
        </a>
    </div>
{% endif %}

<!-- Statistics -->
<div class="columns mt-5">
    <div class="column is-4">
        <div class="card">
            <div class="card-content">
                <div class="content has-text-centered">
                    <span class="icon is-large has-text-primary">
                        <i class="fas fa-flask fa-2x"></i>
                    </span>
                    <p class="title is-3">{{ exames|length }}</p>
                    <p class="subtitle is-6">Total de Exames</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="column is-4">
        <div class="card">
            <div class="card-content">
                <div class="content has-text-centered">
                    <span class="icon is-large has-text-info">
                        <i class="fas fa-eye fa-2x"></i>
                    </span>
                    <p class="title is-3">Público</p>
                    <p class="subtitle is-6">Disponível para Consulta</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="column is-4">
        <div class="card">
            <div class="card-content">
                <div class="content has-text-centered">
                    <span class="icon is-large has-text-success">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </span>
                    <p class="title is-3">Ativo</p>
                    <p class="subtitle is-6">Sistema Funcionando</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete(nome) {
    document.getElementById('exameNome').textContent = nome;
    document.getElementById('deleteForm').action = "{{ url_for('admin_delete_exame', nome='') }}" + encodeURIComponent(nome);
    document.getElementById('deleteModal').classList.add('is-active');
}

function closeModal() {
    document.getElementById('deleteModal').classList.remove('is-active');
}

// Close modal when clicking on background
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('deleteModal');
    const modalBackground = modal.querySelector('.modal-background');
    
    modalBackground.addEventListener('click', closeModal);
    
    // Close modal with ESC key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('is-active')) {
            closeModal();
        }
    });
});
</script>
{% endblock %} 